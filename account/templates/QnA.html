{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG QnA</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/QnA.css' %}">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <h2>‚öôÔ∏è Configuration</h2>
        
        <form action="{% url 'configure_llm' %}" method="post" class="llm-form">
            {% csrf_token %}
            <div class="form-group">
                <label for="llm_provider">Provider</label>
                <select name="llm_provider" id="llm_provider">
                    {% for provider, data in providers.items %}
                        <option value="{{ provider }}" {% if current.provider == provider %}selected{% endif %}>
                            {{ provider }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="model_name">Model</label>
                <input type="text" name="model_name" id="model_name" value="{{ current.model|default:provider_models.0 }}" placeholder="Enter model name">
            </div>

            <button type="submit" class="btn-save">üíæ Save Configuration</button>
        </form>

        <div class="status-indicator">
            <strong>Status:</strong> {{ status_msg }}
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="qna-container">
            <div class="qna-header">
                <h1>ü§ñ Welcome, What's Your Query?</h1>
                <p>Ask me anything and I'll help you find the answers</p>
            </div>

            <!-- Search Bar -->
            <form action="{% url 'rag_qna_page' %}" method="post" class="ask-form">
                {% csrf_token %}
                <div class="search-container">
                    <div class="search-bar">
                        {{ ask_form.question }}
                        <button type="submit" class="search-btn">üîç</button>
                    </div>
                </div>
            </form>

            <!-- Chat Display -->
            <div class="chat-container">
                <div class="chat-box">
                    {% for message in chat %}
                        <div class="chat-msg {{ message.who }}">
                            <strong>{{ message.who|title }}:</strong> {{ message.text|safe }}
                            {% if message.llm %}<small class="llm-info">(LLM: {{ message.llm }})</small>{% endif %}
                        </div>
                    {% empty %}
                        <div class="empty-chat">
                            <p>üí¨ No chat history yet. Ask your first question!</p>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Clear Chat -->
            <form action="{% url 'clear_chat' %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn-clear">üóëÔ∏è Clear Chat History</button>
            </form>
        </div>
    </div>
</body>
</html>